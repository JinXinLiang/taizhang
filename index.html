<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>日销售成品油台账生成工具</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>日销售成品油台账生成工具</h1>
    <form id="salesForm">
        <label for="totalDays">销售总天数:</label>
        <input type="number" id="totalDays" name="totalDays" required><br><br>
        <label for="rowsPerPage">每页显示条数:</label>
        <input type="number" id="rowsPerPage" name="rowsPerPage" required><br><br>
        <div id="machinesContainer">
            <div class="machine">
                <label for="machineId">加油机编号:</label>
                <input type="text" class="machineId" name="machineId" required><br><br>
                <label for="days">销售天数:</label>
                <input type="number" class="days" name="days" required><br><br>
                <label for="startOil">起始油数量:</label>
                <input type="number" class="startOil" name="startOil" required><br><br>
                <label for="totalSales">销售总量:</label>
                <input type="number" class="totalSales" name="totalSales" required><br><br>
                <label for="totalAmount">销售总额:</label>
                <input type="number" class="totalAmount" name="totalAmount" required><br><br>
            </div>
        </div>
        <button type="button" onclick="addMachine()">添加加油机</button><br><br>
        <button type="button" onclick="generateLedger()">生成台账</button>
    </form>
    <br>
    <div id="ledger"></div>

    <script>
        // 添加加油机表单
        function addMachine() {
            const container = document.getElementById('machinesContainer');
            const machineDiv = document.createElement('div');
            machineDiv.className = 'machine';
            machineDiv.innerHTML = `
                <label for="machineId">加油机编号:</label>
                <input type="text" class="machineId" name="machineId" required><br><br>
                <label for="days">销售天数:</label>
                <input type="number" class="days" name="days" required><br><br>
                <label for="startOil">起始油数量:</label>
                <input type="number" class="startOil" name="startOil" required><br><br>
                <label for="totalSales">销售总量:</label>
                <input type="number" class="totalSales" name="totalSales" required><br><br>
                <label for="totalAmount">销售总额:</label>
                <input type="number" class="totalAmount" name="totalAmount" required><br><br>
            `;
            container.appendChild(machineDiv);
        }

        // 生成台账
        function generateLedger() {
            const totalDays = parseInt(document.getElementById('totalDays').value);
            const rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
            const machines = document.getElementsByClassName('machine');
            let allSalesData = [];

            // 遍历每个加油机，生成销售数据
            for (let machine of machines) {
                const machineId = machine.querySelector('.machineId').value;
                const days = parseInt(machine.querySelector('.days').value);
                const startOil = parseFloat(machine.querySelector('.startOil').value);
                const totalSales = parseFloat(machine.querySelector('.totalSales').value);
                const totalAmount = parseFloat(machine.querySelector('.totalAmount').value);
                const unitPrice = totalAmount / totalSales;

                let salesPerDay = [];
                let remainingSales = totalSales;

                // 随机生成每日销售量
                for (let i = 0; i < days; i++) {
                    let dailySales = (i === days - 1) ? remainingSales : parseFloat((Math.random() * (remainingSales / (days - i))).toFixed(2));
                    salesPerDay.push(dailySales);
                    remainingSales -= dailySales;
                }

                // 随机选择销售天数
                let selectedDays = [];
                while (selectedDays.length < days) {
                    let randomDay = Math.floor(Math.random() * totalDays) + 1;
                    if (!selectedDays.includes(randomDay)) {
                        selectedDays.push(randomDay);
                    }
                }
                selectedDays.sort((a, b) => a - b);

                // 生成每一天的销售数据
                let currentStartOil = startOil;
                for (let i = 0; i < days; i++) {
                    let dailySales = salesPerDay[i];
                    let dailyAmount = dailySales * unitPrice;
                    let currentEndOil = currentStartOil + dailySales;
                    allSalesData.push({
                        day: selectedDays[i],
                        machineId: machineId,
                        startOil: currentStartOil.toFixed(2),
                        endOil: currentEndOil.toFixed(2),
                        sales: dailySales.toFixed(2),
                        unitPrice: unitPrice.toFixed(2),
                        amount: dailyAmount.toFixed(2)
                    });
                    currentStartOil = currentEndOil;
                }
            }

            // 确保每一天都有每个加油机的数据
            for (let day = 1; day <= totalDays; day++) {
                for (let machine of machines) {
                    const machineId = machine.querySelector('.machineId').value;
                    if (!allSalesData.find(d => d.day === day && d.machineId === machineId)) {
                        allSalesData.push({
                            day: day,
                            machineId: machineId,
                            startOil: '',
                            endOil: '',
                            sales: '',
                            unitPrice: '',
                            amount: ''
                        });
                    }
                }
            }

            // 按天和加油机编号排序
            allSalesData.sort((a, b) => a.day - b.day || a.machineId.localeCompare(b.machineId));

            let ledgerHtml = '';
            let pageCount = Math.ceil(allSalesData.length / rowsPerPage);

            // 生成分页表格
            for (let page = 0; page < pageCount; page++) {
                let pageSalesTotal = 0;
                let pageAmountTotal = 0;

                ledgerHtml += `<table>
                                <tr>
                                    <th>日期</th>
                                    <th>加油机编号</th>
                                    <th>起始油数量</th>
                                    <th>结束油数量</th>
                                    <th>销售量</th>
                                    <th>单价</th>
                                    <th>销售额</th>
                                </tr>`;

                for (let i = page * rowsPerPage; i < (page + 1) * rowsPerPage && i < allSalesData.length; i++) {
                    let data = allSalesData[i];
                    ledgerHtml += `<tr>
                                    <td>第${data.day}天</td>
                                    <td>${data.machineId}</td>
                                    <td>${data.startOil}</td>
                                    <td>${data.endOil}</td>
                                    <td>${data.sales > 0 ? data.sales : ''}</td>
                                    <td>${data.unitPrice}</td>
                                    <td>${data.amount > 0 ? data.amount : ''}</td>
                                   </tr>`;
                    pageSalesTotal += parseFloat(data.sales) || 0;
                    pageAmountTotal += parseFloat(data.amount) || 0;
                }

                ledgerHtml += `<tr>
                                <td colspan="4">当前页合计</td>
                                <td>${pageSalesTotal.toFixed(2)}</td>
                                <td></td>
                                <td>${pageAmountTotal.toFixed(2)}</td>
                               </tr>`;
                ledgerHtml += `</table><br>`;
            }

            document.getElementById('ledger').innerHTML = ledgerHtml;
        }
    </script>
</body>
</html>